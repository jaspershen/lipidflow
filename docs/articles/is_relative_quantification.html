<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Step 2: get relative quantification data • lipidflow</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Step 2: get relative quantification data">
<meta property="og:description" content="lipidflow">
<meta property="og:image" content="https://jaspershen.github.io/lipidflow/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-000000-01"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-000000-01');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">lipidflow</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="Under development">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Help documents
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Brief introduction</li>
    <li>
      <a href="../articles/lipidflow.html">Brief introduction of lipidflow</a>
    </li>
    <li>
      <a href="../articles/overview_of_lipidflow.html">Overview of workflow of lipidflow</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Absolute quantification of lipids</li>
    <li>
      <a href="../articles/get_is_retention_time.html">Step 1: get internal standard retention time</a>
    </li>
    <li>
      <a href="../articles/is_relative_quantification.html">Step 2: get relative quantification data</a>
    </li>
    <li>
      <a href="../articles/absolute_quantification.html">Step 3: get absolute quantification data</a>
    </li>
    <li>
      <a href="../articles/output_result.html">Step 4: output and organize results</a>
    </li>
    <li class="divider">
    <li>
      <a href="../articles/one_step_of_lipidflow.html">One function to all steps</a>
    </li>
    <li class="dropdown-header">Other tools in lipidflow</li>
    <li>
      <a href="../articles/lipidflow.html">Other tools in lipidflow</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    News
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../news/index.html">Change log</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/contact_us.html">Contact us</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/lipidflow.html">Get started</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jaspershen/lipidflow/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://twitter.com/JasperShen1990">
    <span class="fab fa-twitter fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="is_relative_quantification_files/header-attrs-2.6/header-attrs.js"></script><link href="is_relative_quantification_files/vembedr-0.1.4/css/vembedr.css" rel="stylesheet">
<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Step 2: get relative quantification data</h1>
                        <h4 class="author">Xiaotao Shen PhD (<a href="https://www.shenxt.info/" class="uri">https://www.shenxt.info/</a>)</h4>
                                    <h4 class="author">Chuchu wang PhD</h4>
            <address class="author_afil">
      School of Medicine, Stanford University<br><h4 class="date">Created on 2021-02-09 and updated on 2021-03-01</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jaspershen/lipidflow/blob/master/vignettes/is_relative_quantification.Rmd"><code>vignettes/is_relative_quantification.Rmd</code></a></small>
      <div class="hidden name"><code>is_relative_quantification.Rmd</code></div>

    </address>
</div>

    
    
<hr>
<p>This step is used to get the relative quantification data of internal standards and lipids in all samples. If you have not finished the previous step, please click here:</p>
<p><a href="https://jaspershen.github.io/lipidflow/articles/get_is_retention_time.html">Get retention time of internal standards</a>.</p>
<p>If you have finished this step, click here to next step:</p>
<p><a href="https://jaspershen.github.io/lipidflow/articles/absolute_quantification.html">Absolute quantification</a>.</p>
<hr>
<div id="get-relative-quantification" class="section level1">
<h1 class="hasAnchor">
<a href="#get-relative-quantification" class="anchor"></a><strong>Get relative quantification</strong>
</h1>
<p>We should have finished <a href="https://jaspershen.github.io/lipidflow/articles/get_is_retention_time.html">step 1</a>. Then we combine the internal standard information from positive and negative mode.</p>
<hr>
<div id="combine-internal-standard-information" class="section level2">
<h2 class="hasAnchor">
<a href="#combine-internal-standard-information" class="anchor"></a><strong>Combine internal standard information</strong>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jaspershen/lipidflow">lipidflow</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ycphs.github.io/openxlsx/index.html">openxlsx</a></span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">is_info_table_new_pos</span> <span class="op">=</span> 
  <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_xlsx</a></span><span class="op">(</span><span class="st">"example/POS/IS_info_new.xlsx"</span><span class="op">)</span>

<span class="va">is_info_table_new_neg</span> <span class="op">=</span> 
  <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_xlsx</a></span><span class="op">(</span><span class="st">"example/NEG/IS_info_new.xlsx"</span><span class="op">)</span>

<span class="va">is_info_table_new</span> <span class="op">=</span>
  <span class="va">is_info_table_new_pos</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">is_info_table_new_neg</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"name"</span>, <span class="st">"rt_neg_second"</span>, <span class="st">"rt_neg_min"</span>, <span class="st">"adduct_neg"</span>, <span class="st">"mz_neg"</span><span class="op">)</span><span class="op">]</span>,
                   by <span class="op">=</span> <span class="st">"name"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">is_info_table_new</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 x 13</span>
<span class="co">#&gt;   name  exact.mass formula ug_ml    um rt_pos_second rt_pos_min adduct_pos</span>
<span class="co">#&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;         &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;     </span>
<span class="co">#&gt; 1 15:0…       588. C36H61… 0.22  0.375         1147.       19.1 M+H-H2O   </span>
<span class="co">#&gt; 2 15:0…       690. C36H61… 0.172 0.25           783.       13.0 M+H       </span>
<span class="co">#&gt; 3 15:0…       753. C41H73… 1.88  2.5           1182.       19.7 M+H       </span>
<span class="co">#&gt; 4 15:0…       711. C38H67… 0.125 0.175         1193.       19.9 M+H       </span>
<span class="co">#&gt; 5 15:0…       764. C39H67… 0.095 0.125         1181.       19.7 M+H       </span>
<span class="co">#&gt; 6 15:0…       847. C42H75… 0.422 0.5           1147.       19.1 M+H       </span>
<span class="co">#&gt; # … with 5 more variables: mz_pos &lt;dbl&gt;, rt_neg_second &lt;dbl&gt;, rt_neg_min &lt;dbl&gt;,</span>
<span class="co">#&gt; #   adduct_neg &lt;chr&gt;, mz_neg &lt;dbl&gt;</span></code></pre></div>
<p>Then we output the <code>is_info_table_new</code> into the <code>example/Result</code> folder.</p>
<p>We first create a folder named as <code>Result</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="st">"example/Result"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="st">"example/Result"</span><span class="op">)</span>
<span class="fu">openxlsx</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/write.xlsx.html">write.xlsx</a></span><span class="op">(</span><span class="va">is_info_table_new</span>,
                     file <span class="op">=</span> <span class="st">"example/Result/IS_info_table.xlsx"</span><span class="op">)</span></code></pre></div>
<hr>
</div>
<div id="relative-quantification" class="section level2">
<h2 class="hasAnchor">
<a href="#relative-quantification" class="anchor"></a><strong>Relative quantification</strong>
</h2>
<div id="positive-mode" class="section level3">
<h3 class="hasAnchor">
<a href="#positive-mode" class="anchor"></a><strong>1. Positive mode</strong>
</h3>
<p>We need to get the sample information of samples first.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sample_info_pos</span> <span class="op">=</span>
  <span class="fu"><a href="../reference/generate_sample_info.html">generate_sample_info</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">"example/POS"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">sample_info_pos</span><span class="op">)</span>
<span class="co">#&gt;   sample.name group</span>
<span class="co">#&gt; 1       D25_1   D25</span>
<span class="co">#&gt; 2       D25_2   D25</span>
<span class="co">#&gt; 3       M19_1   M19</span>
<span class="co">#&gt; 4       M19_2   M19</span></code></pre></div>
<p>Get the <code>Cholesterol</code> retention time:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="va">is_info_table_new</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Cholesterol"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">idx</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">is_info_table_new</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Cholesterol"</span><span class="op">)</span>
  <span class="va">chol_rt2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">is_info_table_new</span><span class="op">$</span><span class="va">rt_pos_second</span><span class="op">[</span><span class="va">idx</span><span class="op">]</span>,
               <span class="va">is_info_table_new</span><span class="op">$</span><span class="va">rt_neg_second</span><span class="op">[</span><span class="va">idx</span><span class="op">]</span><span class="op">)</span>
  <span class="va">chol_rt2</span> <span class="op">=</span> <span class="va">chol_rt2</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">chol_rt2</span><span class="op">)</span><span class="op">]</span>
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">chol_rt2</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">chol_rt</span> <span class="op">=</span> <span class="va">chol_rt2</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>
  <span class="op">}</span>
<span class="op">}</span> <span class="kw">else</span><span class="op">{</span>
  <span class="va">chol_rt</span> <span class="op">=</span> <span class="fl">1169</span>
<span class="op">}</span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">chol_rt</span>
<span class="co">#&gt; [1] 1720.245</span></code></pre></div>
<div id="internal-standards" class="section level4">
<h4 class="hasAnchor">
<a href="#internal-standards" class="anchor"></a><strong>Internal standards</strong>
</h4>
<p>Then run <code><a href="../reference/get_relative_quantification.html">get_relative_quantification()</a></code> to get the relative quantification data of internal standards:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/get_relative_quantification.html">get_relative_quantification</a></span><span class="op">(</span>
  path <span class="op">=</span> <span class="st">"example/POS"</span>,
  targeted_table_name <span class="op">=</span> <span class="st">"IS_info_new.xlsx"</span>,
  sample_info <span class="op">=</span> <span class="va">sample_info_pos</span>,
  targeted_table_type <span class="op">=</span> <span class="st">"is"</span>,
  polarity <span class="op">=</span> <span class="st">"positive"</span>,
  chol_rt <span class="op">=</span> <span class="va">chol_rt</span>,
  output_eic <span class="op">=</span> <span class="cn">TRUE</span>,
  ppm <span class="op">=</span> <span class="fl">40</span>,
  rt.tolerance <span class="op">=</span> <span class="fl">180</span>,
  threads <span class="op">=</span> <span class="fl">5</span>,
  rerun <span class="op">=</span> <span class="cn">FALSE</span>
<span class="op">)</span>
<span class="co">#&gt; Reading raw data, it will take a while...</span>
<span class="co">#&gt; Reading 18519 spectra from file D25_1.mzXML</span>
<span class="co">#&gt; Reading 18473 spectra from file D25_2.mzXML</span>
<span class="co">#&gt; Reading 18464 spectra from file M19_1.mzXML</span>
<span class="co">#&gt; Reading 18381 spectra from file M19_2.mzXML</span>
<span class="co">#&gt; ✓ OK</span>
<span class="co">#&gt; Extracting peaks, it will take a while...✓ OK</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Output peak shapes...</span>
<span class="co">#&gt; 1  2  3  4  5  6  7  8  9  10  11  12  13  14  15  16  17  18  19  20  </span>
<span class="co">#&gt; Done</span></code></pre></div>
<p><strong>The meanings of parameters:</strong></p>
<ol style="list-style-type: decimal">
<li><p><code>path</code>: Work directory. Here we set as <code>example/POS</code>.</p></li>
<li><p><code>targeted_table_name</code>: The name of internal standard information.</p></li>
<li><p><code>sample_info</code>: sample information of samples.</p></li>
<li><p><code>targeted_table_type</code>: The type of extracted peaks, “is” (internal standard) or “lipid” (lipids).</p></li>
<li><p><code>polarity</code>: “positive” or <code>negative</code>.</p></li>
<li><p><code>chol_rt</code>: Cholesterol retention time (second).</p></li>
<li><p><code>output_eic</code>: Output EICs of peaks or not.</p></li>
<li><p><code>ppm</code>: peak detection ppm.</p></li>
<li><p><code>rt.tolerance</code>: peak detection retention time tolerance (second).</p></li>
<li><p><code>threads</code>: Number of cores to run.</p></li>
<li><p><code>rerun</code>: Rerun peak detection or not.</p></li>
</ol>
<p>Then all the results are outputted into a folder named as <code>example/POS/is_relative_quantification</code>. The relative quantification table is <code>is_quantification_table.xlsx</code> and all the peak shapes are in <code>peak_shape</code>.</p>
<p><code>is_quantification_table.xlsx</code> is:</p>
<div class="figure">
<img src="../man/figures/figure23.png" alt=""><p class="caption">is_quantification_table.xlsx</p>
</div>
<p>One example of peak shape (15_0-18_1(d7) PC):</p>
<p>Rectangle region means the integrate of peak region.</p>
<iframe title="Internal standard" src="../man/figures/15_0_18_1_d7_PC.html" width="100%" height="600" scrolling="no" seamless="seamless" frameborder="0"></iframe>
</div>
<div id="lipids" class="section level4">
<h4 class="hasAnchor">
<a href="#lipids" class="anchor"></a><strong>Lipids</strong>
</h4>
<p>Then run <code><a href="../reference/get_relative_quantification.html">get_relative_quantification()</a></code> for lipids:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/get_relative_quantification.html">get_relative_quantification</a></span><span class="op">(</span>
  path <span class="op">=</span> <span class="st">"example/POS"</span>,
  output_path_name <span class="op">=</span> <span class="st">"lipid_relative_quantification"</span>,
  targeted_table_name <span class="op">=</span> <span class="st">"lipid_annotation_table_pos.xlsx"</span>,
  sample_info <span class="op">=</span> <span class="va">sample_info_pos</span>,
  targeted_table_type <span class="op">=</span> <span class="st">"lipid"</span>,
  polarity <span class="op">=</span> <span class="st">"positive"</span>,
  chol_rt <span class="op">=</span> <span class="va">chol_rt</span>,
  output_eic <span class="op">=</span> <span class="cn">TRUE</span>,
  ppm <span class="op">=</span> <span class="fl">40</span>,
  rt.tolerance <span class="op">=</span> <span class="fl">180</span>,
  threads <span class="op">=</span> <span class="fl">5</span>,
  rerun <span class="op">=</span> <span class="cn">FALSE</span>
<span class="op">)</span>
<span class="co">#&gt; Error in nlsModel(formula, mf, start, wts) : </span>
<span class="co">#&gt;   singular gradient matrix at initial parameter estimates</span>
<span class="co">#&gt; Error in nlsModel(formula, mf, start, wts) : </span>
<span class="co">#&gt;   singular gradient matrix at initial parameter estimates</span>
<span class="co">#&gt; Error in nlsModel(formula, mf, start, wts) : </span>
<span class="co">#&gt;   singular gradient matrix at initial parameter estimates</span>
<span class="co">#&gt; Error in nlsModel(formula, mf, start, wts) : </span>
<span class="co">#&gt;   singular gradient matrix at initial parameter estimates</span>
<span class="co">#&gt; Error in nlsModel(formula, mf, start, wts) : </span>
<span class="co">#&gt;   singular gradient matrix at initial parameter estimates</span>
<span class="co">#&gt; Error in nlsModel(formula, mf, start, wts) : </span>
<span class="co">#&gt;   singular gradient matrix at initial parameter estimates</span>
<span class="co">#&gt; Error in nlsModel(formula, mf, start, wts) : </span>
<span class="co">#&gt;   singular gradient matrix at initial parameter estimates</span>
<span class="co">#&gt; Error in nlsModel(formula, mf, start, wts) : </span>
<span class="co">#&gt;   singular gradient matrix at initial parameter estimates</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Output peak shapes...</span>
<span class="co">#&gt; 1  2  3  4  5  6  7  8  9  10  11  12  13  14  15  16  17  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32  33  34  35  36  37  38  39  40  41  42  43  44  45  46  47  48  49  50  51  52  53  54  55  56  57  58  59  60  61  62  63  64  65  66  67  68  69  70  71  72  73  74  75  76  77  78  79  80  81  82  83  84  85  86  87  88  89  90  91  92  93  94  95  96  97  98  99  100  101  102  103  104  105  106  107  108  109  110  111  112  113  114  115  116  117  118  119  120  121  122  123  124  125  126  127  128  129  130  131  132  133  134  135  136  137  138  139  140  141  142  143  144  145  146  147  148  149  150  151  152  153  154  155  156  157  158  159  160  161  162  163  164  165  166  167  168  169  170  171  172  173  174  175  176  177  178  </span>
<span class="co">#&gt; Done</span></code></pre></div>
<p>Here the <code>targeted_table_name</code> is the annotation table from <code>lipidsearch</code>. It should be placed in <code>POS</code> and <code>NEG</code> folders, respectively.</p>
<p><img src="../man/figures/figure24.png"></p>
<p>The results are outputted in <code>example/POS/lipid_relative_quantification</code> folder. These results are similar with internal standards.</p>
</div>
</div>
<div id="negative-mode" class="section level3">
<h3 class="hasAnchor">
<a href="#negative-mode" class="anchor"></a><strong>2. Negative mode</strong>
</h3>
<p>Negative mode is same with positive mode.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sample_info_neg</span> <span class="op">=</span>
  <span class="fu"><a href="../reference/generate_sample_info.html">generate_sample_info</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">"example/NEG"</span><span class="op">)</span></code></pre></div>
<div id="internal-standards-1" class="section level4">
<h4 class="hasAnchor">
<a href="#internal-standards-1" class="anchor"></a><strong>Internal standards</strong>
</h4>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/get_relative_quantification.html">get_relative_quantification</a></span><span class="op">(</span>
  path <span class="op">=</span> <span class="st">"example/NEG"</span>,
  output_path_name <span class="op">=</span> <span class="st">"is_relative_quantification"</span>,
  targeted_table_name <span class="op">=</span> <span class="st">"IS_info_new.xlsx"</span>,
  sample_info <span class="op">=</span> <span class="va">sample_info_neg</span>,
  targeted_table_type <span class="op">=</span> <span class="st">"is"</span>,
  polarity <span class="op">=</span> <span class="st">"negative"</span>,
  chol_rt <span class="op">=</span> <span class="va">chol_rt</span>,
  output_integrate <span class="op">=</span> <span class="cn">TRUE</span>,
  output_eic <span class="op">=</span> <span class="cn">TRUE</span>,
  ppm <span class="op">=</span> <span class="fl">40</span>,
  rt.tolerance <span class="op">=</span> <span class="fl">180</span>,
  threads <span class="op">=</span> <span class="fl">5</span>,
  rerun <span class="op">=</span> <span class="cn">FALSE</span>
<span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Output peak shapes...</span>
<span class="co">#&gt; 1  2  3  4  5  6  7  8  9  10  11  12  13  14  15  </span>
<span class="co">#&gt; Done</span></code></pre></div>
</div>
<div id="lipids-1" class="section level4">
<h4 class="hasAnchor">
<a href="#lipids-1" class="anchor"></a><strong>Lipids</strong>
</h4>
<p>Then run <code><a href="../reference/get_relative_quantification.html">get_relative_quantification()</a></code> for lipids:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/get_relative_quantification.html">get_relative_quantification</a></span><span class="op">(</span>
  path <span class="op">=</span> <span class="st">"example/NEG"</span>,
  output_path_name <span class="op">=</span> <span class="st">"lipid_relative_quantification"</span>,
  targeted_table_name <span class="op">=</span> <span class="st">"lipid_annotation_table_neg.xlsx"</span>,
  sample_info <span class="op">=</span> <span class="va">sample_info_neg</span>,
  targeted_table_type <span class="op">=</span> <span class="st">"lipid"</span>,
  polarity <span class="op">=</span> <span class="st">"negative"</span>,
  chol_rt <span class="op">=</span> <span class="va">chol_rt</span>,
  output_eic <span class="op">=</span> <span class="cn">TRUE</span>,
  ppm <span class="op">=</span> <span class="fl">40</span>,
  rt.tolerance <span class="op">=</span> <span class="fl">180</span>,
  threads <span class="op">=</span> <span class="fl">5</span>,
  rerun <span class="op">=</span> <span class="cn">FALSE</span>
<span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Output peak shapes...</span>
<span class="co">#&gt; 1  2  3  4  5  6  7  8  9  10  11  12  13  14  15  16  17  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32  33  34  35  36  37  38  39  40  41  42  43  44  45  46  47  48  49  50  51  52  53  54  55  56  57  58  59  60  61  </span>
<span class="co">#&gt; Done</span></code></pre></div>
<hr>
</div>
</div>
</div>
<div id="manually-check-for-relative-quantification-data-of-internal-standards" class="section level2">
<h2 class="hasAnchor">
<a href="#manually-check-for-relative-quantification-data-of-internal-standards" class="anchor"></a><strong>Manually check for relative quantification data of internal standards</strong>
</h2>
<p>Sometimes, the peak detection maybe not accurate, so we need to manually check the peak shape of all the internal standards and then detect peak and integrate peak shape again.</p>
<p>For example, the internal standard 18_1_d7_ Lyso PC in positive mode (<code>example/POS/is_relative_quantification/peak_shape/18_1_d7_ Lyso PC.html</code>), the peak shape is like below figure shows:</p>
<iframe title="Internal standard" src="../man/figures/figure31.html" width="100%" height="600" scrolling="no" seamless="seamless" frameborder="0"></iframe>
<p>From this figure, we can see that for the samples <code>D25_1</code>, <code>D25_2</code> and <code>M19_2</code>, the integrate region (begin point) is not correct, so we need to manually correct that.</p>
<ol style="list-style-type: decimal">
<li>Open the table in <code>example/POS/is_relative_quantification/forced_targeted_peak_table_temple.xlsx</code>, like the below figure shows:</li>
</ol>
<p><img src="../man/figures/figure32.png"></p>
<ol start="2" style="list-style-type: decimal">
<li>Then open the peak shape plot for each internal standard in <code>example/POS/is_relative_quantification/peak_shape</code>. Then if you find that the peak integration is not correct, you can add the right begin and end retention time for peaks like below video shows:</li>
</ol>
<div class="vembedr embed-responsive embed-responsive-16by9" align="center">
<div>
<iframe src="https://www.youtube.com/embed/OiUdqkw5KZc" width="533" height="300" frameborder="0" allowfullscreen="" class="embed-responsive-item"></iframe>
</div>
</div>
<p>After check all the internal standards which are not normal, please rename it as <code>forced_targeted_peak_table_temple_manual.xlsx</code> and rerun <code><a href="../reference/get_relative_quantification.html">get_relative_quantification()</a></code>, and note that <strong>set <code>forced_targeted_peak_table_name</code> as <code>forced_targeted_peak_table_temple_manual.xlsx</code></strong>:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/get_relative_quantification.html">get_relative_quantification</a></span><span class="op">(</span>
  path <span class="op">=</span> <span class="st">"example/POS"</span>,
  forced_targeted_peak_table_name <span class="op">=</span> <span class="st">"forced_targeted_peak_table_temple_manual.xlsx"</span>,
  output_path_name <span class="op">=</span> <span class="st">"is_relative_quantification"</span>,
  targeted_table_name <span class="op">=</span> <span class="st">"IS_info_new.xlsx"</span>,
  sample_info <span class="op">=</span> <span class="va">sample_info_pos</span>,
  targeted_table_type <span class="op">=</span> <span class="st">"is"</span>,
  polarity <span class="op">=</span> <span class="st">"positive"</span>,
  chol_rt <span class="op">=</span> <span class="va">chol_rt</span>,
  output_integrate <span class="op">=</span> <span class="cn">TRUE</span>,
  output_eic <span class="op">=</span> <span class="cn">TRUE</span>,
  ppm <span class="op">=</span> <span class="fl">40</span>,
  rt.tolerance <span class="op">=</span> <span class="fl">180</span>,
  threads <span class="op">=</span> <span class="fl">5</span>,
  rerun <span class="op">=</span> <span class="cn">FALSE</span>
<span class="op">)</span>
<span class="co">#&gt; Manually check..</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Output peak shapes...</span>
<span class="co">#&gt; 10  </span>
<span class="co">#&gt; Done</span></code></pre></div>
<p>Then open the internal standard 18_1_d7_ Lyso PC in positive mode (<code>example/POS/is_relative_quantification/peak_shape/18_1_d7_ Lyso PC.html</code>), the peak detection is good for now:</p>
<iframe title="Internal standard" src="../man/figures/figure33.html" width="100%" height="600" scrolling="no" seamless="seamless" frameborder="0"></iframe>
<p><strong>For the negative mode, we can also manually check internal standards like this and rerun to get more accurate peak integration and relative quantification data.</strong></p>
</div>
<div id="next-step" class="section level2">
<h2 class="hasAnchor">
<a href="#next-step" class="anchor"></a><strong>Next step</strong>
</h2>
<p>Next we need to get the absolute quantification data of all lipids in all sample.</p>
<p>Please click here:</p>
<p><a href="https://jaspershen.github.io/lipidflow/articles/absolute_quantification.html">Step3: get absolute quantification data</a></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Xiaotao Shen, Chuchu Wang.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '21ff2860978c5d2ceb7d4150364070ff',
    indexName: 'lipidflow',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
